import type { Request, Response } from 'express';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// Набор токенов из исходного Rust init_db (индексы, id, bracket, level). count=0
const TOKENS: Array<{ index: number; id: string; bracket: number; level: string }> = [
  { index: 0, id: '34425828061736843426912096298091509161636518061529758238302960523841204387859', bracket: 0, level: 'Common' },
  { index: 1, id: '34425828061736843426912096298091509161636518061529758238302960523841204387845', bracket: 0, level: 'Common' },
  { index: 2, id: '34425828061736843426912096298091509161636518061529758238302960523841204387858', bracket: 0, level: 'Common' },
  { index: 3, id: '34425828061736843426912096298091509161636518061529758238302960523841204387866', bracket: 0, level: 'Common' },
  { index: 4, id: '34425828061736843426912096298091509161636518061529758238302960523841204387856', bracket: 1, level: 'Common' },
  { index: 5, id: '34425828061736843426912096298091509161636518061529758238302960523841204387860', bracket: 1, level: 'Common' },
  { index: 6, id: '34425828061736843426912096298091509161636518061529758238302960523841204387883', bracket: 1, level: 'Common' },
  { index: 7, id: '34425828061736843426912096298091509161636518061529758238302960523841204387861', bracket: 1, level: 'Common' },
  { index: 8, id: '34425828061736843426912096298091509161636518061529758238302960523841204387854', bracket: 2, level: 'Special' },
  { index: 9, id: '34425828061736843426912096298091509161636518061529758238302960523841204387853', bracket: 2, level: 'Special' },
  { index: 10, id: '34425828061736843426912096298091509161636518061529758238302960523841204387850', bracket: 2, level: 'Special' },
  { index: 11, id: '34425828061736843426912096298091509161636518061529758238302960523841204387849', bracket: 3, level: 'Special' },
  { index: 12, id: '34425828061736843426912096298091509161636518061529758238302960523841204387862', bracket: 3, level: 'Special' },
  { index: 13, id: '34425828061736843426912096298091509161636518061529758238302960523841204387871', bracket: 3, level: 'Special' },
  { index: 14, id: '34425828061736843426912096298091509161636518061529758238302960523841204387881', bracket: 4, level: 'Special' },
  { index: 15, id: '34425828061736843426912096298091509161636518061529758238302960523841204387867', bracket: 4, level: 'Special' },
  { index: 16, id: '34425828061736843426912096298091509161636518061529758238302960523841204387847', bracket: 4, level: 'Special' },
  { index: 17, id: '34425828061736843426912096298091509161636518061529758238302960523841204387878', bracket: 5, level: 'Special' },
  { index: 18, id: '34425828061736843426912096298091509161636518061529758238302960523841204387863', bracket: 5, level: 'Special' },
  { index: 19, id: '34425828061736843426912096298091509161636518061529758238302960523841204387876', bracket: 5, level: 'Special' },
  { index: 20, id: '34425828061736843426912096298091509161636518061529758238302960523841204387869', bracket: 6, level: 'Special' },
  { index: 21, id: '34425828061736843426912096298091509161636518061529758238302960523841204387882', bracket: 6, level: 'Special' },
  { index: 22, id: '34425828061736843426912096298091509161636518061529758238302960523841204387873', bracket: 6, level: 'Special' },
  { index: 23, id: '34425828061736843426912096298091509161636518061529758238302960523841204387857', bracket: 7, level: 'Rare' },
  { index: 24, id: '34425828061736843426912096298091509161636518061529758238302960523841204387870', bracket: 7, level: 'Rare' },
  { index: 25, id: '34425828061736843426912096298091509161636518061529758238302960523841204387851', bracket: 8, level: 'Rare' },
  { index: 26, id: '34425828061736843426912096298091509161636518061529758238302960523841204387865', bracket: 8, level: 'Rare' },
  { index: 27, id: '34425828061736843426912096298091509161636518061529758238302960523841204387864', bracket: 9, level: 'Rare' },
  { index: 28, id: '34425828061736843426912096298091509161636518061529758238302960523841204387855', bracket: 9, level: 'Rare' },
  { index: 29, id: '34425828061736843426912096298091509161636518061529758238302960523841204387846', bracket: 10, level: 'Rare' },
  { index: 30, id: '34425828061736843426912096298091509161636518061529758238302960523841204387875', bracket: 10, level: 'Rare' },
  { index: 31, id: '34425828061736843426912096298091509161636518061529758238302960523841204387848', bracket: 11, level: 'Rare' },
  { index: 32, id: '34425828061736843426912096298091509161636518061529758238302960523841204387852', bracket: 11, level: 'Rare' },
  { index: 33, id: '34425828061736843426912096298091509161636518061529758238302960523841204387841', bracket: 15, level: 'Unique' },
  { index: 34, id: '34425828061736843426912096298091509161636518061529758238302960523841204387879', bracket: 15, level: 'Unique' },
  { index: 35, id: '34425828061736843426912096298091509161636518061529758238302960523841204387880', bracket: 15, level: 'Unique' },
  { index: 36, id: '34425828061736843426912096298091509161636518061529758238302960523841204387874', bracket: 15, level: 'Unique' },
  { index: 37, id: '34425828061736843426912096298091509161636518061529758238302960523841204387844', bracket: 15, level: 'Legendary' },
];

export async function initDb(_req: Request, res: Response) {
  try {
    for (const t of TOKENS) {
      await prisma.tokens.upsert({
        where: { index: t.index },
        update: { id: t.id, count: 0, bracket: t.bracket, level: t.level },
        create: { index: t.index, id: t.id, count: 0, bracket: t.bracket, level: t.level },
      });
    }
    res.json({ ok: true, inserted: TOKENS.length });
  } catch (e) {
    res.status(500).json({ ok: false, error: (e as Error).message });
  }
}


